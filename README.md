**find_smth_in_gitlab** — CLI-инструмент для поиска пользовательских паттернов в файлах проектов GitLab по динамическому списку устройств, полученному из NetBox.

**Версия:** 1.1.0 build 20250807

---

## Основные возможности

- **Аудит файлов в каждом проекте GitLab согласно выборке из NetBox**
- **Фильтрация устройств/проектов** по любым полям устройства в NetBox (site, role, model, и пр.)
- **Гибкий поиск** любого регулярного выражения внутри любого файла в каждом проекте
- **Гибкая настройка** через YAML-файл, не требуется править сам скрипт

---

## Требования

- Python 3.12.0
- Установленная пользовательская библиотека `github.com/CherMet90/custom_python_modules.git`
- Токен GitLab должен иметь роль **Reporter** или выше и scopes: `api`

---

## Быстрый старт

1. **Установите зависимости:**
    ```
    pip install -r requirements.txt
    ```

2. **Создайте YAML-конфиги задач в каталоге `configs/`:**

4. **Посмотрите список готовых задач:**
    ```
    python main.py --list-configs
    ```

5. **Запустите поиск:**
    ```
    python main.py <имя_yaml-конфига>
    ```
    (или просто укажите имя YAML-конфига, без пути и расширения — будет подставлено автоматически)

---

## Особенности

- Список проектов формируется по данным NetBox, фильтруемым через YAML.
- Все детали поиска (какие проекты, какой файл, какой regex) задаются в YAML.
- Результат поиска всегда сохраняется в CSV-файл с именем, совпадающим с именем конфига, в папке reports/.
- В отчете в колонке Matched_String отображается вся строка файла, в которой найден паттерн (включая оригинальные отступы).
- Для поиска по “всем кроме некоторых ролей” используйте в filters: role__n: [исключаемые значения].

---

## Распространенные проблемы

- **403 Forbidden при попытке чтения файлов** — требуется повысить роль токена до Reporter в группе/проекте GitLab.
- **404 Project Not Found** — проверьте корректность запрашиваемого имени проекта. В качестве имени проекта используется значение свойства объекта Netbox, указанного в `repo_name_field` YAML.

---

## Разделение кода

- Данный скрипт для своей работы использует пользовательскую библиотеку `custom_modules` (см. требования)
- Конфигурация поиска — из каталога `configs/`, один YAML на одну задачу аудита.
